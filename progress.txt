# Progress Log
# Generated by sonata
# Started: 2026-01-24T17:55:01.603Z
# Task file: Spec: First class folder sync support

---

## Iteration 1 - 2026-01-24

### Task Completed
- Added `LocalFolderConfig` and `LocalFolder` models (combined first two spec tasks)

### Key Decisions
- `LocalFolderConfig`: OneToOneField to KhojUser with `enabled` flag (per-user config)
- `LocalFolder`: ForeignKey to LocalFolderConfig with `path` (CharField max 1000) and `last_synced_at` (DateTimeField, nullable)
- Used `unique_together = ["config", "path"]` to prevent duplicate folder paths per user
- Followed existing patterns from GithubConfig/GithubRepoConfig models
- Both models inherit from DbBaseModel (includes created_at, updated_at)

### Files Changed
- src/khoj/database/models/__init__.py (added LocalFolderConfig and LocalFolder models)

### Notes
- Models added at end of file after UserMemory model
- Python syntax verified
- Next steps: Add database adapters for CRUD operations, then create migration

---

## Iteration 2 - 2026-01-24

### Task Completed
- Added database adapters for folder config CRUD operations

### Key Decisions
- Created `LocalFolderConfigAdapters` class following existing adapter patterns
- Provided both sync and async versions of methods (prefixed with `a` for async)
- Used `@require_valid_user` and `@arequire_valid_user` decorators for user validation
- Adapter methods include:
  - `get_or_create_config` / `aget_or_create_config` - Get or create user's config
  - `get_config` / `aget_config` - Get config with prefetched folders
  - `set_enabled` / `aset_enabled` - Enable/disable folder sync
  - `is_enabled` / `ais_enabled` - Check if sync is enabled
  - `get_folders` / `aget_folders` - List all folders for user
  - `add_folder` / `aadd_folder` - Add a folder path (idempotent)
  - `remove_folder` / `aremove_folder` - Remove a folder path
  - `get_folder_by_path` / `aget_folder_by_path` - Get specific folder
  - `update_folder_sync_time` / `aupdate_folder_sync_time` - Update last_synced_at
  - `get_all_enabled_configs` / `aget_all_enabled_configs` - Server-wide query for all enabled configs

### Files Changed
- src/khoj/database/adapters/__init__.py (added LocalFolder and LocalFolderConfig imports, added LocalFolderConfigAdapters class)

### Notes
- Python syntax verified
- Followed existing patterns from GithubConfig adapters and other adapter classes
- Next steps: Create database migration for new models

---

## Iteration 3 - 2026-01-24

### Task Completed
- Created database migration for LocalFolderConfig and LocalFolder models

### Key Decisions
- Migration number: 0100 (following 0099_usermemory.py)
- Depends on: ("database", "0099_usermemory")
- Creates LocalFolderConfig first (parent model), then LocalFolder (child with FK)
- LocalFolderConfig includes: id, created_at, updated_at, enabled, user (OneToOne)
- LocalFolder includes: id, created_at, updated_at, path, last_synced_at, config (FK)
- Followed exact patterns from 0099_usermemory.py migration

### Files Changed
- src/khoj/database/migrations/0100_localfolderconfig_localfolder.py (new file)

### Notes
- Python syntax verified with py_compile
- Migration follows Django conventions for model creation order (parent before child)
- unique_together constraint added for (config, path) pair
- Next steps: Add API endpoints for folder management

